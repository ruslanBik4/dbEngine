// Code generated by qtc from "database_tpl.qtpl". DO NOT EDIT.
// See https://github.com/valyala/quicktemplate for details.

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:1
package _go

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:2
import (
	"fmt"
	"slices"
	"strings"

	"github.com/iancoleman/strcase"
	"github.com/ruslanBik4/dbEngine/dbEngine"
	"github.com/ruslanBik4/dbEngine/dbEngine/psql"
)

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:13
import (
	qtio422016 "io"

	qt422016 "github.com/valyala/quicktemplate"
)

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:13
var (
	_ = qtio422016.Copy
	_ = qt422016.AcquireByteBuffer
)

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:13
func (c *Creator) StreamCreateDatabase(qw422016 *qt422016.Writer, packages, listTables, listRoutines []string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:13
	qw422016.N().S(`// Code generated by dbEngine-gen-go. DO NOT EDIT!
// Copyright https://github.com/ruslanBik4

/*
	Package db

DB implements interface for table, view and routines of Database
versions:

 	dbEngine v1.1.*

source: %s %s
*/
package db

import (
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:30
	for _, lib := range packages {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:30
		qw422016.N().S(`	"`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:31
		qw422016.E().S(lib)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:31
		qw422016.N().S(`"
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:32
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:32
	qw422016.N().S(`)

type scanError interface {
	ScanValue(d any)
	Err() error
}

// ValueDecoder is a value that implements the text and binary encoding and decoding interfaces.
type ValueDecoder[T any] interface {
	pgtype.TextDecoder
	pgtype.BinaryDecoder
	New() T
}

type WrapArray[T ValueDecoder[T]] []T

func (dst *WrapArray[T]) DecodeText(ci *pgtype.ConnInfo, src []byte) (err error) {
	if len(src) == 0 {
		return nil
	}

	arr, err := pgtype.ParseUntypedTextArray(gotools.BytesToString(src))
	if err != nil {
		return err
	}

	if len(arr.Elements) == 0 {
		return nil
	}

	buf := make([]T, len(arr.Elements))
	for i, el := range arr.Elements {
		buf[i] = T.New(buf[i])
		if err := buf[i].DecodeText(ci, gotools.StringToBytes(el)); err != nil {
			return err
		}
	}

	*dst = buf

	return nil
}

func (dst *WrapArray[T]) DecodeBinary(ci *pgtype.ConnInfo, src []byte) (err error) {
	if len(src) == 0 {
		return nil
	}

	arr, err := pgtype.ParseUntypedTextArray(gotools.BytesToString(src))
	if err != nil {
		return err
	}

	if len(arr.Elements) == 0 {
		return nil
	}

	buf := make([]T, len(arr.Elements))
	for i, el := range arr.Elements {
		buf[i] = T.New(buf[i])
		if err := buf[i].DecodeBinary(ci, gotools.StringToBytes(el)); err != nil {
			return err
		}
	}

	*dst = buf

	return nil
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:102
	hasCitext := false

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:102
	qw422016.N().S(`

`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:104
	for _, name := range c.types {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:105
		if name != "citext" {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:105
			c.StreamCreateTypeInterface(qw422016, c.DB.Types[name], strcase.ToCamel(name), name, c.Types[name])
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:105
			qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:106
		} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:106
			qw422016.N().S(`
type CitextArray struct {
	pgtype.TextArray
}

func (dst CitextArray) MarshalJSON() ([]byte, error) {
	buf := bytes.NewBufferString("[")
	for i, text := range dst.Elements {
		if i > 0 {
			buf.WriteString(",")
		}

		buf.WriteString(text.String)
	}

	buf.WriteString("]")

	return buf.Bytes(), nil
}

var customTypes = map[string]*pgtype.DataType{
	"citext": {
		Value: &pgtype.Text{},
		Name:  "citext",
	},
	"_citext": {
		Value: &pgtype.TextArray{},
		Name:  "[]string",
	},
}

var initCustomTypes bool

const sqlGetTypes = "SELECT typname, oid FROM pg_type WHERE typname::text=ANY($1)"

func getOidCustomTypes(ctx context.Context, conn *pgx.Conn) error {
	params := make([]string, 0, len(customTypes))
	for name := range customTypes {
		params = append(params, name)
	}

	rows, err := conn.Query(ctx, sqlGetTypes, params)
	if err != nil {
		return err
	}

	for rows.Next() {
		var name string
		var oid uint32
		err = rows.Scan(&name, &oid)
		if err != nil {
			return err
		}
		if c, ok := customTypes[name]; ok && c.Value == (*pgtype.ArrayType)(nil) {
			c.Value = pgtype.NewArrayType(name, oid, func() pgtype.ValueTranscoder {
				return &pgtype.Text{}
			}).NewTypeValue()
			c.OID = oid
			logs.DebugLog(c)
		} else if ok {
			customTypes[name].OID = oid
		}
	}

	if rows.Err() != nil {
		logs.ErrorLog(rows.Err(), " cannot get oid for customTypes")
	}

	return err
}

// afterConnect create need types & register on conn
func afterConnect(ctx context.Context, conn *pgx.Conn) error {
	// Override registered handler for point
	if !initCustomTypes {
		err := getOidCustomTypes(ctx, conn)
		if err != nil {
			return err
		}

		initCustomTypes = true
	}

	mess := "DB registered type (name, oid): "
	for name, val := range customTypes {
		conn.ConnInfo().RegisterDataType(*val)
		mess += fmt.Sprintf("\n(%s,%v, %T) ", name, val.OID, val.Value)
	}

	logs.StatusLog(conn.PgConn().Conn().LocalAddr().String(), mess)

	return nil
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:199
			hasCitext = true

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:199
			qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:200
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:200
		qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:201
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:201
	qw422016.N().S(`// Database is root interface for operation for %s.%s
type Database struct {
	*dbEngine.DB
	CreateAt time.Time
}

// NewDatabase create new Database with minimal necessary handlers
func NewDatabase(ctx context.Context, noticeHandler pgconn.NoticeHandler, channelHandler pgconn.NotificationHandler, channels ...string) (*Database, error) {
	if noticeHandler == nil {
		noticeHandler = printNotice
	}
	conn := psql.NewConnWithOptions(
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:214
	if hasCitext {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:214
		qw422016.N().S(`psql.AfterConnect(afterConnect),`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:214
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:214
	qw422016.N().S(`		psql.NoticeHandler(noticeHandler),
		psql.ChannelHandler(channelHandler),
		psql.Channels(channels...),
	)

	DB, err := dbEngine.NewDB(ctx, conn)
	if err != nil {
		logs.ErrorLog(err, "new DB")
		return nil, err
	}

	return &Database{DB, time.Now()}, nil
}

func (DB *Database) Notify(ctx context.Context, ch, mess string) string {
	res := ""
	err := DB.Conn.SelectOneAndScan(ctx, &res, "SELECT pg_notify($1,$2)::varchar", ch, mess)
	if err != nil {
		logs.ErrorLog(err, "SELECT pg_notify(%s, %s)", ch, mess)
	} else {
		logs.DebugLog("send notify '%s' in channel '%s': %s", mess, ch, res)
	}

	return res
}

// PsqlConn return connection as *psql.Conn
// need for some low-level operation,
// invoke Conn.Select...(custom sql),
//        New{table_name}FromConn, etc.
func (d *Database) PsqlConn() *psql.Conn {
	return (d.Conn).(*psql.Conn)
}

// SaveDataToTable
func (d *Database) SaveDataToTable(ctx context.Context, table string, r io.Reader, columns ... string) error {
	switch table {
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:252
	for _, name := range listTables {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:252
		qw422016.N().S(`	case "`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:253
		qw422016.E().S(name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:253
		qw422016.N().S(`":
		t, err := d.New`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:254
		qw422016.E().S(strcase.ToCamel(name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:254
		qw422016.N().S(`(ctx)
		if err != nil {
			return err
		}

		err = gob.NewDecoder(r).Decode(&t.DoCopyPoll)
		if err != nil {
			return err
		}

		t.doCopyPoolCount = len(t.DoCopyPoll)
		t.doCopyPoolColumns = columns

		return t.doCopy(ctx)
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:268
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:268
	qw422016.N().S(`	default:
		return dbEngine.NewErrNotFoundTable(table)
	}
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:273
	for _, name := range listTables {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:273
		c.StreamCreateTableConstructor(qw422016, strcase.ToCamel(name), name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:273
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:274
	for _, name := range listRoutines {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:274
		c.StreamCreateRoutinesInvoker(qw422016, c.Routines[name].(*psql.Routine), name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:274
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:274
	qw422016.N().S(`// printNotice logging some psql messages (invoked command 'RAISE ...')
func printNotice(c *pgconn.PgConn, n *pgconn.Notice) {
	switch {
    case n.Code == "42P07" || strings.Contains(n.Message, "skipping"):
		logs.DebugLog("skip operation: %s", n.Message)

	case n.Severity == "INFO":
		logs.StatusLog(n.Message)

	case n.Code > "00000":
		err := (*pgconn.PgError)(n)
		logs.CustomLog(
				logs.CRITICAL,
				"DB_EXEC",
				err.File,
				int(err.Line),
				fmt.Sprintf("%v, hint: %s, where: %s, %s %s", err, n.Hint, gotools.StartEndString(n.Where, 100), err.SQLState(), err.Routine),
				logs.FgErr,
			)

	case strings.HasPrefix(n.Message, "[[ERROR]]"):
		logs.ErrorLog(errors.New(strings.TrimPrefix(n.Message, "[[ERROR]]") + n.Severity))

	default: // DEBUG
		logs.DebugLog("%+v %s (PID:%d)", n.Severity, n.Message, c.PID())
	}
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
func (c *Creator) WriteCreateDatabase(qq422016 qtio422016.Writer, packages, listTables, listRoutines []string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	qw422016 := qt422016.AcquireWriter(qq422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	c.StreamCreateDatabase(qw422016, packages, listTables, listRoutines)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	qt422016.ReleaseWriter(qw422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
func (c *Creator) CreateDatabase(packages, listTables, listRoutines []string) string {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	qb422016 := qt422016.AcquireByteBuffer()
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	c.WriteCreateDatabase(qb422016, packages, listTables, listRoutines)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	qs422016 := string(qb422016.B)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	qt422016.ReleaseByteBuffer(qb422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
	return qs422016
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:302
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:304
func (c *Creator) StreamCreateTypeInterface(qw422016 *qt422016.Writer, t dbEngine.Types, typeName, name, typeCol string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:305
	if len(t.Enumerates) == 0 && len(t.Attr) > 0 && t.Attr[0].Name != "domain" {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:305
		qw422016.N().S(`// `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:306
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:306
		qw422016.N().S(` create new instance of type `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:306
		qw422016.E().S(name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:306
		qw422016.N().S(`
//  add Rows interface
type `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:308
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:308
		qw422016.N().S(` struct {
    `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:310
		maxName := len(slices.MaxFunc(t.Attr, func(a, b dbEngine.TypesAttr) int {
			return len(a.Name) - len(b.Name)
		}).Name)
		maxType := len(slices.MaxFunc(t.Attr, func(a, b dbEngine.TypesAttr) int {
			return len(a.Type) - len(b.Type)
		}).Type)

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:316
		qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:317
		for _, attr := range t.Attr {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:317
			qw422016.N().S(`	`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			qw422016.N().S(fmt.Sprintf("%-*s\t\t%-*s\t `json:\"%s", maxName, strcase.ToCamel(attr.Name), maxType, attr.Type, attr.Name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			if !attr.NotOmited() {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
				qw422016.N().S(`,omitempty`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			qw422016.N().S(`"`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			qw422016.N().S("`")
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:318
			qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:319
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:320
		if t.Type == 'r' {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:320
			qw422016.N().S(`	LowerType pgtype.BoundType
	UpperType pgtype.BoundType
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:323
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:323
		qw422016.N().S(`}

// New implement ValueDecoder[T any] interface
func (dst *`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:327
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:327
		qw422016.N().S(`) New() *`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:327
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:327
		qw422016.N().S(`{
	return &`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:328
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:328
		qw422016.N().S(`{}
}

// DecodeText implement pgtype.TextDecoder interface
func (dst *`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:332
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:332
		qw422016.N().S(`) DecodeText(ci *pgtype.ConnInfo, src []byte) error {
	*dst = `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:333
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:333
		qw422016.N().S(`{}
	if len(src) == 0 {
		return nil
	}
	`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:337
		if t.Type == 'r' {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:337
			qw422016.N().S(`
	utr, err := pgtype.ParseUntypedTextRange(gotools.BytesToString(src))
	if err != nil {
		return err
	}
	`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:342
		} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:342
			qw422016.N().S(`
	c := pgtype.NewCompositeTextScanner(ci, src)
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:344
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:344
		qw422016.N().S(`
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:346
		if t.Type == 'r' {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:346
			qw422016.N().S(`    	dst.LowerType = utr.LowerType
    	dst.UpperType = utr.UpperType

    	if dst.LowerType == pgtype.Empty {
    		return nil
    	}

    	if dst.LowerType == pgtype.Inclusive || dst.LowerType == pgtype.Exclusive {
    		if err := dst.Lower.DecodeText(ci, gotools.StringToBytes(utr.Lower)); err != nil {
    			return err
    		}
    	}

    	if dst.UpperType == pgtype.Inclusive || dst.UpperType == pgtype.Exclusive {
    		if err := dst.Upper.DecodeText(ci, gotools.StringToBytes(utr.Upper)); err != nil {
    			return err
    		}
    	}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:365
		} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:366
			for _, attr := range t.Attr {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:366
				qw422016.N().S(`	`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:367
				if strings.HasPrefix(attr.Type, "pgtype.") || strings.HasPrefix(attr.Name, "psql.") {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:367
					qw422016.N().S(`
	c.ScanDecoder`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
				} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
					qw422016.N().S(`c.ScanValue`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
				}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
				qw422016.N().S(`(&dst.`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
				qw422016.E().S(strcase.ToCamel(attr.Name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:368
				qw422016.N().S(`)
	if c.Err() != nil {
		return c.Err()
	}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:372
			}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:373
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:373
		qw422016.N().S(`
	return nil
}

// DecodeBinary implement pgtype.BinaryDecoder interface
func (dst *`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:379
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:379
		qw422016.N().S(`) DecodeBinary(ci *pgtype.ConnInfo, src []byte) error {
	*dst = `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:380
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:380
		qw422016.N().S(`{}
	if len(src) == 0 {
		return nil
	}

`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:385
		if t.Type == 'r' {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:385
			qw422016.N().S(`	utr, err := pgtype.ParseUntypedBinaryRange(src)
	if err != nil {
		return err
	}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:390
		} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:390
			qw422016.N().S(`	c := pgtype.NewCompositeBinaryScanner(ci, src)
	countFields := c.FieldCount()
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:393
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:394
		if t.Type == 'r' {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:394
			qw422016.N().S(`    	dst.LowerType = utr.LowerType
    	dst.UpperType = utr.UpperType

    	if dst.LowerType == pgtype.Empty {
    		return nil
    	}

    	if dst.LowerType == pgtype.Inclusive || dst.LowerType == pgtype.Exclusive {
    		if err := dst.Lower.DecodeBinary(ci, utr.Lower); err != nil {
    			return err
    		}
    	}

    	if dst.UpperType == pgtype.Inclusive || dst.UpperType == pgtype.Exclusive {
    		if err := dst.Upper.DecodeBinary(ci, utr.Upper); err != nil {
    			return err
    		}
    	}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:413
		} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:414
			for i, attr := range t.Attr {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:414
				qw422016.N().S(`	//	    rich end of elements
	if countFields < `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:416
				qw422016.N().D(i + 1)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:416
				qw422016.N().S(` || !c.Next() {
		return nil
	}
	if err := `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:419
				if strings.HasPrefix(attr.Name, "pgtype.") || strings.HasPrefix(attr.Name, "psql.") {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:419
					qw422016.N().S(`&dst.`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:419
					qw422016.E().S(strcase.ToCamel(attr.Name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:419
					qw422016.N().S(`.DecodeBinary(ci, c.Bytes())
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
				} else {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
					qw422016.N().S(`ci.Scan(c.OID(), pgtype.BinaryFormatCode, c.Bytes(), &dst.`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
					qw422016.E().S(strcase.ToCamel(attr.Name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
					qw422016.N().S(`)`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
				}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:420
				qw422016.N().S(`; err != nil {
		logs.ErrorLog(err, "`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:421
				qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:421
				qw422016.N().S(`.`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:421
				qw422016.E().S(strcase.ToCamel(attr.Name))
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:421
				qw422016.N().S(`")
		return err
	}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:424
			}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:425
		}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:425
		qw422016.N().S(`
	return nil
}

// Scan implement sql.Scanner interface
func (dst *`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:431
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:431
		qw422016.N().S(`) Scan(src any) error {
	switch src := src.(type) {
	case nil:
		*dst = `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:434
		qw422016.E().S(typeName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:434
		qw422016.N().S(`{}
		return nil
	case string:
		return dst.DecodeText(nil, gotools.StringToBytes(src))
	case []byte:
		return dst.DecodeText(nil, src)
	default:
		return fmt.Errorf("cannot scan %T", src)
	}
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:444
	}
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
func (c *Creator) WriteCreateTypeInterface(qq422016 qtio422016.Writer, t dbEngine.Types, typeName, name, typeCol string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	qw422016 := qt422016.AcquireWriter(qq422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	c.StreamCreateTypeInterface(qw422016, t, typeName, name, typeCol)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	qt422016.ReleaseWriter(qw422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
func (c *Creator) CreateTypeInterface(t dbEngine.Types, typeName, name, typeCol string) string {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	qb422016 := qt422016.AcquireByteBuffer()
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	c.WriteCreateTypeInterface(qb422016, t, typeName, name, typeCol)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	qs422016 := string(qb422016.B)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	qt422016.ReleaseByteBuffer(qb422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
	return qs422016
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:445
}

// end CreateTypeInterface
//

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:448
func (c *Creator) StreamCreateTableConstructor(qw422016 *qt422016.Writer, goName, name string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:448
	qw422016.N().S(`// New`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:449
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:449
	qw422016.N().S(` create new instance of table `)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:449
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:449
	qw422016.N().S(`
func (d *Database) New`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:450
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:450
	qw422016.N().S(`(ctx context.Context) (*`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:450
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:450
	qw422016.N().S(`, error) {
	switch table, err := New`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:451
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:451
	qw422016.N().S(`(d.DB); err.(type) {
	case nil:
		return table, nil

	// no found on Database - get data of table from Conn
	case dbEngine.ErrNotFoundTable:
		table, err := New`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:457
	qw422016.E().S(goName)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:457
	qw422016.N().S(`FromConn(ctx, d.PsqlConn())
		if err != nil {
			return nil, err
		}
		d.Tables[table.Name()] = table
		return table, nil
		
	default:
		return nil, err
	}
}
`)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
func (c *Creator) WriteCreateTableConstructor(qq422016 qtio422016.Writer, goName, name string) {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	qw422016 := qt422016.AcquireWriter(qq422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	c.StreamCreateTableConstructor(qw422016, goName, name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	qt422016.ReleaseWriter(qw422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
}

//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
func (c *Creator) CreateTableConstructor(goName, name string) string {
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	qb422016 := qt422016.AcquireByteBuffer()
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	c.WriteCreateTableConstructor(qb422016, goName, name)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	qs422016 := string(qb422016.B)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	qt422016.ReleaseByteBuffer(qb422016)
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
	return qs422016
//line /Users/ruslan_bik/GolandProjects/dbEngine/generators/go/database_tpl.qtpl:468
}
